(()=>{var e={};e.id=409,e.ids=[409],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},24467:()=>{},26723:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});var a=r(92570);let n="https://ulntyefamkxkbynrugop.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY;function o(){if(!n||!s)throw Error("Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).");return(0,a.UU)(n,s,{auth:{autoRefreshToken:!1,persistSession:!1}})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},38310:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>u,serverHooks:()=>b,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>p});var a={};r.r(a),r.d(a,{GET:()=>d});var n=r(43007),s=r(44360),o=r(98343),i=r(28142),c=r(26723);async function d(){let e={environment:{url:!0,anonKey:!0,serviceKey:!!process.env.SUPABASE_SERVICE_ROLE_KEY},database:{connected:!1,attendanceTable:!1,studentsTable:!1,rpcFunction:!1},schema:{studentIdType:"unknown",deviceIdType:"unknown",rlsEnabled:"unknown",policiesCount:0,foreignKeysCount:0},test:{canRead:!1,canWrite:!1,error:null}};try{let t=(0,c._)();e.database.connected=!!t;let{data:r,error:a}=await t.from("attendance_records").select("id").limit(1);e.database.attendanceTable=!a,e.test.canRead=!a;let{data:n,error:s}=await t.from("students").select("id").limit(1);e.database.studentsTable=!s;try{let{data:r,error:a}=await t.rpc("get_attendance_records",{record_limit:1,since_time:new Date(Date.now()-864e5).toISOString()});e.database.rpcFunction=!a}catch(t){e.database.rpcFunction=!1,e.test.error=`RPC Error: ${t?.message}`}e.test.canWrite=!0;try{let{data:r,error:a}=await t.rpc("exec_sql",{query:`
          SELECT 
            column_name,
            data_type
          FROM information_schema.columns
          WHERE table_name = 'attendance_records'
          AND column_name IN ('student_id', 'device_id')
        `});!a&&r&&(e.schema.studentIdType="text",e.schema.deviceIdType="text")}catch(e){}try{let{data:r,error:a}=await t.rpc("exec_sql",{query:`
          SELECT rowsecurity
          FROM pg_tables
          WHERE tablename = 'attendance_records'
        `});e.schema.rlsEnabled=r?.[0]?.rowsecurity?"enabled":"disabled"}catch(e){}}catch(t){e.test.error=t?.message||"Unknown error",console.error("Database health check error:",t)}let t=e.environment.url&&e.environment.anonKey&&e.environment.serviceKey&&e.database.connected&&e.database.attendanceTable&&e.database.studentsTable;return i.NextResponse.json({success:t,timestamp:new Date().toISOString(),checks:e,recommendations:t?["All systems operational!"]:[!e.environment.url&&"Set NEXT_PUBLIC_SUPABASE_URL in Vercel",!e.environment.anonKey&&"Set NEXT_PUBLIC_SUPABASE_ANON_KEY in Vercel",!e.environment.serviceKey&&"Set SUPABASE_SERVICE_ROLE_KEY in Vercel",!e.database.connected&&"Check Supabase connection",!e.database.attendanceTable&&"Run complete-fix-all-errors.sql in Supabase",!e.database.studentsTable&&"Ensure students table exists",!e.database.rpcFunction&&"Run create-rpc-function.sql in Supabase"].filter(Boolean)},{status:200})}let u=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/debug/database/route",pathname:"/api/debug/database",filename:"route",bundlePath:"app/api/debug/database/route"},resolvedPagePath:"D:\\capstone\\StNinoFinals\\app\\api\\debug\\database\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:p,serverHooks:b}=u;function m(){return(0,o.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:p})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55591:e=>{"use strict";e.exports=require("https")},61419:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[6535,2038,2570],()=>r(38310));module.exports=a})();