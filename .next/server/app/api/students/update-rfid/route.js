(()=>{var e={};e.id=2808,e.ids=[2808],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},20106:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>f,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>p});var r={};t.r(r),t.d(r,{POST:()=>d});var n=t(43007),a=t(44360),o=t(98343),i=t(28142),u=t(26723);async function d(e){try{let s=await e.json();if(!s.email&&!s.studentId)return i.NextResponse.json({success:!1,error:"Email or Student ID is required"},{status:400});if(!s.rfidCard)return i.NextResponse.json({success:!1,error:"RFID Card number is required"},{status:400});let t=(0,u._)();if(!t)return console.error("Supabase admin client not initialized"),i.NextResponse.json({success:!1,error:"Database service not configured. Please check your environment variables."},{status:500});let r=[],n=null;if(s.email){let{data:e,error:a}=await t.from("students").select("*").eq("email",s.email.toLowerCase().trim()).limit(10);r=e||[],n=a}else if(s.studentId){let{data:e,error:a}=await t.from("students").select("*").limit(1e3);!a&&e?r=e.filter(e=>{let t=(e.student_id||"").toString(),r=(e.student_number||"").toString(),n=(e.id||"").toString(),a=(e.studentId||"").toString(),o=s.studentId.toString();return t===o||r===o||n===o||a===o}):n=a}if(n)return console.error("Database error finding student:",n),i.NextResponse.json({success:!1,error:n.message},{status:500});if(!r||0===r.length)return i.NextResponse.json({success:!1,error:"Student not found"},{status:404});let a=r[0],o={rfid_card:s.rfidCard,rfid_tag:s.rfidCard};console.log("Updating student with RFID:",s.rfidCard),console.log("Student ID:",a.id),console.log("Student email:",a.email);let{data:d,error:c}=await t.from("students").update(o).eq("id",a.id).select().single();if(c){if(console.error("Database error updating RFID:",c),console.error("Error message:",c.message),c.message&&(c.message.includes("column")&&c.message.includes("does not exist")||c.message.includes("rfid_tag")||c.message.includes("rfid_card")))return i.NextResponse.json({success:!1,error:"RFID column not found in database. Please add an 'rfid_card' column to your 'students' table in Supabase.",hint:"Run this SQL in Supabase: ALTER TABLE students ADD COLUMN rfid_card TEXT;"},{status:500});return i.NextResponse.json({success:!1,error:`Failed to update RFID: ${c.message}`,details:"Please check your database connection and permissions."},{status:500})}let l={...d};return void 0!==l.Password&&delete l.Password,void 0!==l.password&&delete l.password,i.NextResponse.json({success:!0,student:l,message:"RFID card number updated successfully"})}catch(e){return console.error("Update RFID API error:",e),i.NextResponse.json({success:!1,error:e?.message||"Internal server error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/students/update-rfid/route",pathname:"/api/students/update-rfid",filename:"route",bundlePath:"app/api/students/update-rfid/route"},resolvedPagePath:"D:\\capstone\\StNinoFinals\\app\\api\\students\\update-rfid\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:l,workUnitAsyncStorage:p,serverHooks:m}=c;function f(){return(0,o.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:p})}},24467:()=>{},26723:(e,s,t)=>{"use strict";t.d(s,{_:()=>o});var r=t(92570);let n="https://ulntyefamkxkbynrugop.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY;function o(){if(!n||!a)throw Error("Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).");return(0,r.UU)(n,a,{auth:{autoRefreshToken:!1,persistSession:!1}})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55591:e=>{"use strict";e.exports=require("https")},61419:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[6535,2038,2570],()=>t(20106));module.exports=r})();