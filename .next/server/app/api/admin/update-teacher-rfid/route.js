(()=>{var e={};e.id=3570,e.ids=[3570],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},24467:()=>{},26723:(e,r,t)=>{"use strict";t.d(r,{_:()=>n});var s=t(92570);let a="https://ulntyefamkxkbynrugop.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY;function n(){if(!a||!o)throw Error("Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).");return(0,s.UU)(a,o,{auth:{autoRefreshToken:!1,persistSession:!1}})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55591:e=>{"use strict";e.exports=require("https")},61419:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},97101:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>u,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>p});var s={};t.r(s),t.d(s,{POST:()=>d});var a=t(43007),o=t(44360),n=t(98343),i=t(28142),c=t(26723);async function d(e){try{let{teacherName:r,rfidCard:t}=await e.json();if(!r||!t)return i.NextResponse.json({success:!1,error:"Teacher name and RFID card are required"},{status:400});let s=(0,c._)(),{data:a,error:o}=await s.from("teachers").select("*").limit(1e3);if(o)return console.error("Error fetching teachers:",o),i.NextResponse.json({success:!1,error:o.message},{status:200});let n=r.toLowerCase().trim(),d=(a||[]).filter(e=>{let r=`${e.first_name||""} ${e.last_name||""}`.trim().toLowerCase(),t=(e.name||"").toLowerCase(),s=(e.email||"").toLowerCase();return r.includes(n)||t.includes(n)||s.includes(n)});if(!d||0===d.length)return i.NextResponse.json({success:!1,error:`No teacher found with name containing "${r}"`,searchedName:r,availableTeachers:(a||[]).slice(0,10).map(e=>({name:`${e.first_name||""} ${e.last_name||""}`.trim()||e.name||"Unknown",email:e.email||"N/A",id:e.id||e.teacher_id||"N/A"}))},{status:200});let u=d[0],l=`${u.first_name||""} ${u.last_name||""}`.trim()||u.name||"Unknown";console.log(`Found teacher: ${l}`),console.log(`Teacher ID: ${u.id||u.teacher_id}`),console.log(`Assigning RFID: ${t}`);let p=t.toUpperCase().trim(),m={rfid_card:p};console.log(`Attempting to update teacher ${u.id||u.teacher_id} with RFID: ${p}`),console.log("Update fields:",m);let{data:h,error:f}=await s.from("teachers").update(m).eq("id",u.id).select().single();if(f){console.error("Database error updating RFID:",f),console.error("Error code:",f.code),console.error("Error message:",f.message),console.error("Error details:",f.details),console.error("Error hint:",f.hint);let e=(f.message||"").toLowerCase();if(e.includes("column")&&(e.includes("does not exist")||e.includes("not found")||e.includes("rfid_card")))return i.NextResponse.json({success:!1,error:"RFID column 'rfid_card' not found in teachers table.",hint:"Run this SQL in Supabase: ALTER TABLE teachers ADD COLUMN rfid_card TEXT;",teacherFound:!0,teacherName:l,teacherId:u.id||u.teacher_id,actualError:f.message,errorCode:f.code},{status:200});return i.NextResponse.json({success:!1,error:`Failed to update RFID: ${f.message}`,teacherFound:!0,teacherName:l,errorCode:f.code,errorDetails:f.details,errorHint:f.hint},{status:200})}let g={...h};return void 0!==g.Password&&delete g.Password,void 0!==g.password&&delete g.password,i.NextResponse.json({success:!0,teacher:g,message:`RFID card ${t} assigned to ${l} successfully`,teacherName:l,rfidCard:t.toUpperCase().trim()},{status:200})}catch(e){return console.error("Update teacher RFID API error:",e),i.NextResponse.json({success:!1,error:e?.message||"Internal server error"},{status:200})}}let u=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/admin/update-teacher-rfid/route",pathname:"/api/admin/update-teacher-rfid",filename:"route",bundlePath:"app/api/admin/update-teacher-rfid/route"},resolvedPagePath:"D:\\capstone\\StNinoFinals\\app\\api\\admin\\update-teacher-rfid\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:p,serverHooks:m}=u;function h(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:p})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[6535,2038,2570],()=>t(97101));module.exports=s})();