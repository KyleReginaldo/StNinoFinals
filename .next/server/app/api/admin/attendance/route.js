(()=>{var e={};e.id=3591,e.ids=[3591],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},24467:()=>{},26723:(e,t,s)=>{"use strict";s.d(t,{_:()=>i});var r=s(92570);let n="https://ulntyefamkxkbynrugop.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY;function i(){if(!n||!a)throw Error("Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).");return(0,r.UU)(n,a,{auth:{autoRefreshToken:!1,persistSession:!1}})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49919:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>S,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>l});var r={};s.r(r),s.d(r,{GET:()=>d});var n=s(43007),a=s(44360),i=s(98343),o=s(28142),u=s(26723);async function d(){try{let e=(0,u._)(),t={summary:{presentStudents:245,totalStudents:280,presentTeachers:18,totalTeachers:20,lastSync:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},rfid:{status:"online",activeCards:265,pendingActivations:3,offlineReaders:0},recentScans:[{id:"1",studentName:"Juan Dela Cruz",gradeLevel:"Grade 10",section:"A",scanTime:new Date().toISOString(),status:"Present"},{id:"2",studentName:"Maria Santos",gradeLevel:"Grade 11",section:"B",scanTime:new Date(Date.now()-3e5).toISOString(),status:"Present"},{id:"3",studentName:"Jose Garcia",gradeLevel:"Grade 9",section:"C",scanTime:new Date(Date.now()-6e5).toISOString(),status:"Present"}],recentAlerts:[{id:"1",type:"info",message:"RFID system operating normally",timestamp:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}]};try{let{data:s,error:r}=await e.from("attendance_records").select("*, students(*)").order("scan_time",{ascending:!1}).limit(10);if(!r&&s&&s.length>0){let r=new Date().toISOString().split("T")[0],n=s.filter(e=>e.scan_time?.startsWith(r)||e.created_at?.startsWith(r)),a=new Set(n.map(e=>e.student_id||e.students?.student_id)),{count:i}=await e.from("students").select("*",{count:"exact",head:!0}).eq("status","enrolled");t.summary.presentStudents=a.size,t.summary.totalStudents=i||280,t.recentScans=s.slice(0,5).map(e=>({id:e.id?.toString()||"",studentName:e.students?`${e.students.first_name||""} ${e.students.last_name||""}`.trim()||e.students.name:"Unknown Student",gradeLevel:e.students?.grade_level||"N/A",section:e.students?.section||"N/A",scanTime:e.scan_time||e.created_at,status:e.status||"Present"}))}}catch(e){console.warn("Using mock attendance data:",e)}return o.NextResponse.json({success:!0,data:t})}catch(e){return console.error("Attendance API error:",e),o.NextResponse.json({success:!0,error:e?.message||"Database connection error",data:{summary:{presentStudents:0,totalStudents:0,presentTeachers:0,totalTeachers:0,lastSync:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},rfid:{status:"offline",activeCards:0,pendingActivations:0,offlineReaders:0},recentScans:[],recentAlerts:[]},mock:!0},{status:200})}}let c=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/attendance/route",pathname:"/api/admin/attendance",filename:"route",bundlePath:"app/api/admin/attendance/route"},resolvedPagePath:"D:\\capstone\\StNinoFinals\\app\\api\\admin\\attendance\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:p,workUnitAsyncStorage:l,serverHooks:m}=c;function S(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:l})}},55591:e=>{"use strict";e.exports=require("https")},61419:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[6535,2038,2570],()=>s(49919));module.exports=r})();