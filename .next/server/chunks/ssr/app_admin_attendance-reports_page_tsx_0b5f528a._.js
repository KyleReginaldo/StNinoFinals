module.exports=[72513,a=>{"use strict";var b=a.i(95526),c=a.i(54161),d=a.i(40695),e=a.i(3130),f=a.i(5522),g=a.i(17171),h=a.i(87682),i=a.i(88237),j=a.i(62159),k=a.i(10522),k=k,l=a.i(46916),m=a.i(88533),n=a.i(4640),o=a.i(21113);function p(){let[a,p]=(0,o.useState)(null),[q,r]=(0,o.useState)(!0),[s,t]=(0,o.useState)(null),[u,v]=(0,o.useState)(""),[w,x]=(0,o.useState)(""),[y,z]=(0,o.useState)(""),[A,B]=(0,o.useState)("all"),[C,D]=(0,o.useState)("all");(0,o.useEffect)(()=>{let a=new Date,b=new Date;b.setDate(b.getDate()-30),x(b.toISOString().split("T")[0]),z(a.toISOString().split("T")[0])},[]);let E=async()=>{r(!0),t(null);try{let a=new URLSearchParams;w&&a.append("startDate",w),y&&a.append("endDate",y),u&&a.append("studentId",u),A&&"all"!==A&&a.append("gradeLevel",A),C&&"all"!==C&&a.append("section",C),console.log("ðŸ” Fetching attendance reports with params:",a.toString());let b=await fetch(`/api/admin/attendance-reports?${a.toString()}`);if(!b.ok)throw Error(`HTTP error! status: ${b.status}`);let c=await b.json();console.log("ðŸ“Š API Response:",c),c.success&&c.data?(p(c.data),t(null),!u&&c.data.students.length>0&&v(c.data.students[0].studentId)):(t(c.error||"Failed to fetch attendance data"),p(null))}catch(a){console.error("âŒ Error fetching attendance reports:",a),t(a?.message||"An error occurred while fetching attendance data"),p(null)}finally{r(!1)}};(0,o.useEffect)(()=>{w&&y&&E()},[w,y,u,A,C]);let F=(0,o.useMemo)(()=>a&&u?a.students.find(a=>a.studentId===u)||a.selectedStudent:null,[a,u]),G=(0,o.useMemo)(()=>{if(!a)return[];let b=[],c=new Date(a.dateRange.start),d=new Date(a.dateRange.end);console.log(`start date: ${c}, end date: ${d}`);for(let a=new Date(c);a<=d;a.setDate(a.getDate()+1))b.push(new Date(a).toISOString().split("T")[0]);return b},[a]),H=a=>new Date(a).toLocaleDateString("en-US",{weekday:"short",month:"numeric",day:"numeric"}),I=(0,o.useMemo)(()=>{if(!F)return null;let a={PR:0,AC:0,LA:0,EX:0,HO:0,EA:0,DA:0,SU:0,O:0,VA:0,CR:0,D1:0,D2:0,D3:0,D4:0,D5:0,D6:0};return Object.values(F.dailyAttendance).forEach(b=>{a.hasOwnProperty(b)&&a[b]++}),a},[F]);return q?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(m.RefreshCcw,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-red-800"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading attendance reports..."})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-red-50",children:[(0,b.jsx)("header",{className:"bg-white shadow-sm border-b-2 border-red-800",children:(0,b.jsx)("div",{className:"container mx-auto px-6 py-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(n.default,{href:"/admin",children:(0,b.jsxs)(d.Button,{variant:"ghost",size:"sm",className:"hover:bg-red-50",children:[(0,b.jsx)(j.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-red-800",children:"Attendance Reports"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Student attendance monitoring and analytics"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(d.Button,{onClick:E,variant:"outline",size:"sm",className:"hover:bg-red-50",children:[(0,b.jsx)(m.RefreshCcw,{className:"w-4 h-4 mr-2"}),"Refresh"]}),a&&a.students.length>0&&(0,b.jsxs)(d.Button,{onClick:()=>{if(!a||!a.students.length)return;let b=[["#","Name","Total Days","Present","Absent","Late","Excused","%",...G.map(a=>H(a))]];a.students.forEach((a,c)=>{let d=[(c+1).toString(),a.studentName,a.totalDays.toString(),a.present.toString(),a.absent.toString(),a.late.toString(),a.excused.toString(),`${a.percentage}%`,...G.map(b=>a.dailyAttendance[b]||"-")];b.push(d)});let c=new Blob([b.map(a=>a.map(a=>`"${a.toString().replace(/"/g,'""')}"`).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),e=URL.createObjectURL(c);d.setAttribute("href",e),d.setAttribute("download",`attendance-report-${w}-to-${y}.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},size:"sm",className:"bg-green-600 hover:bg-green-700",children:[(0,b.jsx)(l.Download,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})})}),(0,b.jsxs)("div",{className:"container mx-auto px-6 py-6",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-r from-white to-red-50 rounded-xl shadow-md border-2 border-red-100 p-6 mb-6",children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(k.default,{className:"w-5 h-5 text-red-600"}),"Filter Options"]}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Select date range and filters to view attendance data"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"startDate",className:"text-sm font-semibold text-gray-700",children:"Start Date"}),(0,b.jsx)(f.Input,{id:"startDate",type:"date",value:w,onChange:a=>x(a.target.value),className:"w-fit border-2 border-gray-200 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"endDate",className:"text-sm font-semibold text-gray-700",children:"End Date"}),(0,b.jsx)(f.Input,{id:"endDate",type:"date",value:y,onChange:a=>z(a.target.value),className:"w-fit border-2 border-gray-200 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"gradeFilter",className:"text-sm font-semibold text-gray-700",children:"Grade Level"}),(0,b.jsxs)(h.Select,{value:A,onValueChange:B,children:[(0,b.jsx)(h.SelectTrigger,{id:"gradeFilter",className:"border-2 border-gray-200 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Grades"}),a?.filters.gradeLevels.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"sectionFilter",className:"text-sm font-semibold text-gray-700",children:"Section"}),(0,b.jsxs)(h.Select,{value:C,onValueChange:D,children:[(0,b.jsx)(h.SelectTrigger,{id:"sectionFilter",className:"border-2 border-gray-200 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Sections"}),a?.filters.sections.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))]})]})]})]})]}),s?(0,b.jsx)(e.Card,{children:(0,b.jsxs)(e.CardContent,{className:"py-12 text-center",children:[(0,b.jsxs)("div",{className:"text-red-600 mb-4",children:[(0,b.jsx)("p",{className:"text-lg font-semibold",children:"Error Loading Attendance Data"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:s})]}),(0,b.jsxs)(d.Button,{onClick:E,variant:"outline",className:"mt-4",children:[(0,b.jsx)(m.RefreshCcw,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})}):a&&0!==a.students.length?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 grid grid-cols-3 gap-4",children:[(0,b.jsx)(e.Card,{className:"border-l-4 border-blue-500 shadow-sm",children:(0,b.jsxs)(e.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Total Students"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:a.general.totalStudents})]})}),(0,b.jsx)(e.Card,{className:"border-l-4 border-green-500 shadow-sm",children:(0,b.jsxs)(e.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Present"}),(0,b.jsxs)("div",{className:"text-3xl font-bold text-green-600",children:[a.general.presentPercentage.toFixed(1),"%"]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[a.general.totalPresent," students"]})]})}),(0,b.jsx)(e.Card,{className:"border-l-4 border-red-500 shadow-sm",children:(0,b.jsxs)(e.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Absent"}),(0,b.jsxs)("div",{className:"text-3xl font-bold text-red-600",children:[a.general.absentPercentage.toFixed(1),"%"]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[a.general.totalAbsent," students"]})]})})]}),(0,b.jsxs)(e.Card,{className:"shadow-sm",children:[(0,b.jsx)(e.CardHeader,{className:"pb-4",children:(0,b.jsx)(e.CardTitle,{className:"text-lg font-semibold text-gray-900",children:"Student Details"})}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{htmlFor:"studentSelect",className:"text-sm font-medium text-gray-700 mb-2 block",children:"Select Student"}),(0,b.jsxs)(h.Select,{value:u,onValueChange:v,children:[(0,b.jsx)(h.SelectTrigger,{id:"studentSelect",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select a student"})}),(0,b.jsx)(h.SelectContent,{children:a.students.map(a=>(0,b.jsx)(h.SelectItem,{value:a.studentId,children:a.studentName},a.studentId))})]})]}),F&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3 pt-2",children:[(0,b.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[(0,b.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Total Days"}),(0,b.jsx)("div",{className:"text-xl font-bold text-gray-900",children:F.totalDays})]}),(0,b.jsxs)("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[(0,b.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Present"}),(0,b.jsx)("div",{className:"text-xl font-bold text-green-600",children:F.present})]}),(0,b.jsxs)("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[(0,b.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Attendance"}),(0,b.jsxs)("div",{className:"text-xl font-bold text-red-600",children:[F.percentage,"%"]})]})]}),I&&(0,b.jsxs)("div",{className:"pt-4 border-t",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-gray-700 mb-3",children:"Breakdown"}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2 text-xs",children:Object.entries(I).filter(([a,b])=>b>0).map(([a,c])=>(0,b.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 rounded px-2 py-1",children:[(0,b.jsx)("span",{className:"font-medium text-gray-700",children:a}),(0,b.jsx)("span",{className:"text-gray-900 font-semibold",children:c})]},a))})]})]})]})]})]}),(0,b.jsxs)(e.Card,{className:"mb-6 shadow-sm border-t-4 border-red-800",children:[(0,b.jsxs)(e.CardHeader,{className:"bg-gradient-to-r from-red-50 to-orange-50",children:[(0,b.jsx)(e.CardTitle,{className:"text-xl font-bold text-red-800",children:"Top Performing Students"}),(0,b.jsx)(e.CardDescription,{children:"Students with highest attendance rates"})]}),(0,b.jsx)(e.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:a.students.sort((a,b)=>b.percentage-a.percentage).slice(0,10).map((a,c)=>(0,b.jsxs)("div",{className:`relative p-4 rounded-xl border-2 transition-all hover:shadow-lg hover:scale-105 ${0===c?"bg-gradient-to-br from-yellow-50 to-amber-50 border-yellow-400 shadow-md":1===c?"bg-gradient-to-br from-gray-50 to-slate-50 border-gray-300":2===c?"bg-gradient-to-br from-orange-50 to-amber-50 border-orange-300":"bg-white border-gray-200"}`,children:[(0,b.jsx)("div",{className:"absolute -top-3 -left-3",children:(0,b.jsx)("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm shadow-lg ${0===c?"bg-gradient-to-br from-yellow-400 to-yellow-600 text-white":1===c?"bg-gradient-to-br from-gray-300 to-gray-500 text-white":2===c?"bg-gradient-to-br from-orange-400 to-orange-600 text-white":"bg-gradient-to-br from-red-600 to-red-800 text-white"}`,children:c+1})}),c<3&&(0,b.jsx)("div",{className:"absolute -top-2 -right-2 text-2xl",children:0===c?"ðŸ†":1===c?"ðŸ¥ˆ":"ðŸ¥‰"}),(0,b.jsxs)("div",{className:"space-y-3 mt-2",children:[(0,b.jsx)("div",{className:"font-semibold text-gray-900 text-sm truncate",title:a.studentName,children:a.studentName}),(0,b.jsx)("div",{className:"flex items-center justify-center",children:(0,b.jsxs)("div",{className:"relative w-20 h-20",children:[(0,b.jsxs)("svg",{className:"transform -rotate-90 w-20 h-20",children:[(0,b.jsx)("circle",{cx:"40",cy:"40",r:"32",stroke:"currentColor",strokeWidth:"6",fill:"transparent",className:"text-gray-200"}),(0,b.jsx)("circle",{cx:"40",cy:"40",r:"32",stroke:"currentColor",strokeWidth:"6",fill:"transparent",strokeDasharray:`${2*Math.PI*32}`,strokeDashoffset:`${2*Math.PI*32*(1-a.percentage/100)}`,className:a.percentage>=90?"text-green-500":a.percentage>=70?"text-yellow-500":"text-red-500",strokeLinecap:"round"})]}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[a.percentage,"%"]})})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,b.jsxs)("div",{className:"text-center bg-white/50 rounded-lg py-1",children:[(0,b.jsx)("div",{className:"text-gray-600",children:"Present"}),(0,b.jsx)("div",{className:"font-bold text-green-600",children:a.present})]}),(0,b.jsxs)("div",{className:"text-center bg-white/50 rounded-lg py-1",children:[(0,b.jsx)("div",{className:"text-gray-600",children:"Total"}),(0,b.jsx)("div",{className:"font-bold text-gray-900",children:a.totalDays})]})]})]})]},a.studentId))})})]}),(0,b.jsxs)(e.Card,{className:"shadow-sm",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{className:"text-lg font-semibold text-gray-900",children:"Daily Attendance Records"}),(0,b.jsxs)(e.CardDescription,{children:[a.students.length," student",1!==a.students.length?"s":""," â€¢ ",G.length," days"]})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-12",children:"#"}),(0,b.jsx)(i.TableHead,{children:"Name"}),(0,b.jsx)(i.TableHead,{className:"text-center",children:"Total Days"}),(0,b.jsx)(i.TableHead,{className:"text-center",children:"Present"}),(0,b.jsx)(i.TableHead,{className:"text-center",children:"%"}),G.map(a=>(0,b.jsx)(i.TableHead,{className:"text-center min-w-[80px]",children:H(a)},a))]})}),(0,b.jsx)(i.TableBody,{children:a.students.map((a,d)=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:d+1}),(0,b.jsx)(i.TableCell,{className:"font-semibold",children:a.studentName}),(0,b.jsx)(i.TableCell,{className:"text-center",children:a.totalDays}),(0,b.jsx)(i.TableCell,{className:"text-center",children:a.present}),(0,b.jsx)(i.TableCell,{className:"text-center",children:(0,b.jsxs)(c.Badge,{className:a.percentage>=90?"bg-green-500":a.percentage>=70?"bg-yellow-500":"bg-red-500",children:[a.percentage,"%"]})}),G.map(d=>{let e=a.dailyAttendance[d]||"-";return(0,b.jsx)(i.TableCell,{className:"text-center",children:"-"!==e?(0,b.jsx)(c.Badge,{className:`${(a=>{switch(a){case"PR":return"bg-green-500 text-white";case"AC":return"bg-red-500 text-white";case"LA":return"bg-yellow-500 text-white";case"EX":return"bg-blue-500 text-white";case"HO":return"bg-gray-400 text-white";case"EA":return"bg-orange-500 text-white";case"DA":return"bg-purple-500 text-white";case"SU":return"bg-red-700 text-white";case"O":return"bg-gray-500 text-white";case"VA":return"bg-blue-400 text-white";case"CR":return"bg-purple-400 text-white";case"D1":case"D2":case"D3":case"D4":case"D5":case"D6":return"bg-indigo-500 text-white";default:return"bg-gray-300 text-gray-700"}})(e)} text-xs px-1 py-0`,title:{PR:"Present",AC:"Absent - Coded",LA:"Late",EX:"Excused",HO:"Holiday",EA:"Early Absent",DA:"Day Absent",SU:"Suspended",O:"Other",VA:"Vacation",CR:"Credit",D1:"Day 1",D2:"Day 2",D3:"Day 3",D4:"Day 4",D5:"Day 5",D6:"Day 6"}[e]||e,children:e}):(0,b.jsx)("span",{className:"text-gray-400",children:"-"})},d)})]},a.studentId))})]})})})]})]}):(0,b.jsx)(e.Card,{children:(0,b.jsxs)(e.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)("p",{className:"text-gray-600",children:"No attendance data available."}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Students will appear here once they start scanning their RFID cards."}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 mt-4",children:["Date Range: ",w," to ",y]})]})})]})]})}a.s(["default",()=>p],72513)}];

//# sourceMappingURL=app_admin_attendance-reports_page_tsx_0b5f528a._.js.map